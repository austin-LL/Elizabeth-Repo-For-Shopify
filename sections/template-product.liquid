{% assign current_variant = product.selected_or_first_available_variant %}
{% assign featured_image = current_variant.featured_image | default: product.featured_image %}
<div class="py-16 bg-white">
  <div class="container">
    <div class="flex items-center justify-between mb-8">
      <nav class="flex" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2">
          <li class="flex items-center gap-x-2 mr-2">
            <a href="{{ shop.url }}" class="text-gray-500 hover:text-gray-900">Home</a>
            {% render 'icon-chevron-right' %}
          </li>

          {% for category in product.categories %}
            <li class="flex items-center gap-x-2 mr-2">
              <a href="{{ category.url }}" class="text-gray-500 hover:text-gray-900">{{ category.name }}</a>
              {% render 'icon-chevron-right' %}
            </li>
          {% endfor %}

          <li class="text-gray-900" aria-current="page">{{ product.title }}</li>
        </ol>
      </nav>
    </div>

    <div class="flex flex-wrap gap-x-8 gap-y-10">
      <div class="w-full lg:w-7/12">
        <img
          src="{{ featured_image | img_url: 'large' }}"
          alt="{{ featured_image.alt | escape }}"
          id="ProductPhotoImg"
          width="{{ featured_image.width }}"
          height="{{ featured_image.height }}"
        >
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-2">
          {% for image in product.images %}
            <a href="{{ image.src | img_url: 'large' }}">
              <img src="{{ image.src | img_url: 'compact' }}" alt="{{ image.alt | escape }}" width="{{ image.width }}" height="{{ image.height }}">
            </a>
          {% endfor %}
        </div>
      </div>

      <div class="w-full lg:flex-1 lg:w-auto">
        <h1 class="hdg-3 mb-5">{{ product.title }}</h1>
        <div class="mb-8">{{ product.description }}</div>

        <form action="{{ routes.cart_add_url }}" class="form-skin" method="post" enctype="multipart/form-data" id="AddToCartForm">
          <div class="flex gap-3 mb-5 flex-wrap">
            {% if current_variant.compare_at_price %}
              <p class="paragraph-large text-gray-500 line-through">{{ current_variant.compare_at_price | money }}</p>
            {% endif %}
            <p class="paragraph-large font-semibold text-brand-dark-gray">{{ current_variant.price | money }}</p>
          </div>

          {% unless product.has_only_default_variant %}
            <variant-selector data-url="{{ product.url }}" data-section="{{ section.id }}">
              {% for option in product.options_with_values %}
                <div class="mb-3 last:mb-0">
                  <label class="block mb-1 paragraph-small font-semibold uppercase tracking-widest" for="{{ option.name | handleize }}">{{ option.name }}</label>
                  <select name="{{ option.name | handleize }}" id="{{ option.name | handleize }}" class="py-3 px-5 border border-gray-400 focus:border-black w-full outline-none">
                    {% for value in option.values %}
                      {% if value.available %}
                        <option
                          value="{{ value.id }}"
                          {% if option.selected_value == value %}
                            selected="selected"
                          {% endif %}
                        >
                          {{ value }}
                        </option>
                      {% else %}
                        <option disabled="disabled">
                          {{ value }} - sold out
                        </option>
                      {% endif %}
                    {% endfor %}
                  </select>
                </div>
              {% endfor %}
            </variant-selector>
          {% endunless %}

          <div class="mt-5">
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            <label class="block mb-1 paragraph-small font-semibold uppercase tracking-widest" for="Quantity">Quantity</label>
            <div class="flex flex-wrap items-stretch gap-3">
              <div class="w-full lg:w-auto lg:flex-1">
                <input class="py-3 px-5 border border-gray-400 focus:border-black w-full outline-none" type="number" id="Quantity" name="quantity" value="1" min="1">
              </div>
              <button type="submit" class="btn" name="add" id="AddToCart">Add to cart</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  class VariantSelector extends HTMLElement {
    constructor() {
      super();
      this.addEventListener( 'change', this.onVariantChange );
    }

    onVariantChange() {
      this.getSelectedOptions();
    }

    getSelectedOptions() {
      this.options = Array.from( this.querySelectorAll( 'select' ), (select) => select.value );
      console.log(  this.options );
    }
  }

  customElements.define( "variant-selector", VariantSelector );
</script>